function class(className, super)
    local cls = {}
    cls.className = className
    cls.super = super
    cls.new = function(self, ...)
        local o = setmetatable({}, {__index = cls})
        do
            local create
            create = function(c, ...)
                if c.super then
                    create(c.super, ...)
                end
                local ctor = rawget(c, 'ctor')
                if ctor then
                    ctor(o, ...)
                end
            end
            create(cls, ...)
        end
        return o
    end
    if super then
        setmetatable(
            cls,
            {
                __index = function(t, k)
                    local val = cls.super[k]
                    cls[k] = val
                    return val
                end
            }
        )
    end
    return cls
end

return class
